<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>timer</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link rel="stylesheet" href="home.css" />
  </head>

  <body>
    <div class="container">
      <nav>
        <div class="logo">
          <i class="fa-solid fa-clock"></i>
          <img src="New folder/TIC Logo_Horizontal_Blue.png" alt="logo" />
        </div>
        <div class="links">
          <ul>
            <li>Home</li>
            <li>History</li>
          </ul>
          <i class="fa-solid fa-circle-user"></i>
          <i id="signOutBtn" class="fa-solid fa-arrow-right-from-bracket" title="Sign Out"></i>
        </div>
      </nav>
    </div>
    <div class="timer_section">
      <div class="left">
        <div class="times">
          <div class="startstop">
            <div id="system-start-time">Work starts at 9AM</div>
            <label for="workingtime">Working Time:</label>
            <h2 id="working-time">00:00:00</h2>
          </div>
          <div class="break">
            <div id="system-break-time">Break Starts at: 12:00</div>
            <label for="Break-Time">Break Time</label>
            <h2 id="break-time">00:00</h2>
          </div>
        </div>

        <div class="timer_buttons">
          <button id="start">Start</button>
          <button id="break">start break</button>
        </div>
        <div class="paras">
        <p id="fesshift"></p>
        <p id="brkshift"></p>
        <p id="secshift"></p>
      </div>

      <div class="bottom-page">
        <button id="stop-all-timers">signout</button>
      </div>
      </div>
      <div class="right">
        <div class="work-sheet" id="work-sheet">
          <label for="task-of-day"
            >Task of the day <br>
            <textarea rows="3"
              name=""
              id="task"
              placeholder="What did you do today?"
            ></textarea> <br>
          </label>
          <label for="chanllenges"
            >Chanllenge <br>
            <textarea rows="3"
              name=""
              id="chanllenge"
              placeholder="Did data disturb?"
            ></textarea> <br>
          </label>
          <label for="next-steps"
            >Next steps <br>
            <textarea rows="3"
              name=""
              id="next-steps"
              placeholder="What will you do tomorrow?"
            ></textarea>
          </label>
        </div>
      </div>
    </div>
    <div class="bottoms">
      <div class="alertss" id="alertss">
        <div class="summary-section">
          <h3>Daily Summary</h3>
          <div class="summary-grid">
            <div class="summary-item">
              <span class="summary-label">Arrival Time:</span>
              <span id="arrivalTime" class="summary-value">--:--</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Departure Time:</span>
              <span id="departureTime" class="summary-value">--:--</span>
            </div>
            <div class="summary-item full-width">
              <span class="summary-label">Task of the Day:</span>
              <span id="todayTaskss" class="summary-value">--</span>
            </div>
            <div class="summary-item full-width">
              <span class="summary-label">Challenges Faced:</span>
              <span id="todayDifficylty" class="summary-value">--</span>
            </div>
            <div class="summary-item full-width">
              <span class="summary-label">Next Steps:</span>
              <span id="todaySteps" class="summary-value">--</span>
            </div>
          </div>
        </div>
        
        <div class="statistics-section">
          <h3>Daily Statistics</h3>
          <div class="stats-grid">
            <div class="stat-item">
              <i class="fas fa-clock"></i>
              <div>
                <span class="stat-label">Total Work Time</span>
                <span id="totalWorkTime" class="stat-value">00:00:00</span>
              </div>
            </div>
            <div class="stat-item">
              <i class="fas fa-coffee"></i>
              <div>
                <span class="stat-label">Break Time</span>
                <span id="totalBreakTime" class="stat-value">00:00:00</span>
              </div>
            </div>
            <div class="stat-item">
              <i class="fas fa-tachometer-alt"></i>
              <div>
                <span class="stat-label">Productivity</span>
                <span id="productivity" class="stat-value">0%</span>
              </div>
            </div>
            <div class="stat-item">
              <i class="fas fa-running"></i>
              <div>
                <span class="stat-label">Status</span>
                <span id="status" class="stat-value">On Time</span>
              </div>
            </div>
          </div>
        </div>
        
        <div class="actions">
          <button id="downloadPdf" class="btn-download">
            <i class="fas fa-file-pdf"></i> Download Summary
          </button>
        </div>
      </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
      const workSheet = document.getElementById("work-sheet");
      const task = document.getElementById("task");
      const chanllenge = document.getElementById("chanllenge");
      const nextSteps = document.getElementById("next-steps");
      const stopAllTimersButton = document.getElementById("stop-all-timers");
      const systemTimeDiv = document.getElementById("system-start-time");
      const systemBreakDiv = document.getElementById("system-break-time");
      const startButton = document.getElementById("start");
      const breakButton = document.getElementById("break");
      const downloadBtn = document.getElementById("downloadPdf");
      const fesshift = document.getElementById("fesshift");
      const brkshift = document.getElementById("brkshift");
      const secshift = document.getElementById("secshift");
      const arrivalTime = document.getElementById('arrivalTime');
      const departureTime = document.getElementById('departureTime');
      const todayTaskss = document.getElementById('todayTaskss');
      const todayDifficylty = document.getElementById('todayDifficylty');
      const todaySteps = document.getElementById('todaySteps');
      const totalWorkTimeEl = document.getElementById('totalWorkTime');
      const totalBreakTimeEl = document.getElementById('totalBreakTime');
      const productivityEl = document.getElementById('productivity');
      const statusEl = document.getElementById('status');
      let shiftCount = 0;
      let breakCount = 0;
      let workingTime = 0;
      let breakTime = 0;
      let timerInterval;
      let workStartTime = null;
      let breakStartTime = null;
      let isWorking = false;
      let isOnBreak = false;
      let isLate = false;
      let lateBy = 0; 
      
      function formatTime(seconds) {
        const hours = Math.floor(seconds / 3600).toString().padStart(2, "0");
        const minutes = Math.floor((seconds % 3600) / 60).toString().padStart(2, "0");
        const secs = (seconds % 60).toString().padStart(2, "0");
        return `${hours}:${minutes}:${secs}`;
      }
      
      function formatSimpleTime(date) {
        return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
      }

      function updateDisplay() {
        document.getElementById("working-time").textContent = formatTime(workingTime);
        document.getElementById("break-time").textContent = formatTime(breakTime).substring(3); // Remove hours
      }

      function startWork() {
        if (isWorking) return;
        
        clearInterval(timerInterval);
        workStartTime = new Date();
        isWorking = true;
        isOnBreak = false;
        shiftCount++;
        
        startButton.textContent = "Working...";
        systemTimeDiv.textContent = `Work started at: ${formatSimpleTime(workStartTime)}`;
        
        timerInterval = setInterval(() => {
          workingTime++;
          updateDisplay();
        }, 1000);
        
        if (shiftCount === 1) {
          fesshift.textContent = "You are currently on your first shift";
        } else if (shiftCount >= 2) {
          brkshift.textContent = "Your break is over.";
          secshift.textContent = `You are currently on your ${shiftCount}${shiftCount > 2 ? 'rd' : 'nd'} shift`;
        }
      }

      function startBreak() {
        if (!isWorking || isOnBreak) return;
        
        const now = new Date();
        const currentHour = now.getHours();
        const currentMinute = now.getMinutes();
        
        if (currentHour !== 12) {
          alert("Break time is only allowed between 12:00 PM and 1:00 PM");
          return;
        }
        
        clearInterval(timerInterval);
        breakStartTime = now;
        isOnBreak = true;
        breakCount++;
        
        breakButton.textContent = "On Break...";
        systemBreakDiv.textContent = `Break started at: ${formatSimpleTime(breakStartTime)}`;
        
        timerInterval = setInterval(() => {
          breakTime++;
          updateDisplay();
        }, 1000);
        
        fesshift.textContent = `Your ${shiftCount === 1 ? 'First' : 'Next'} Shift ended at ${formatSimpleTime(now)}`;
        brkshift.textContent = "You are currently on break";
      }

      function calculateProductivity(workTime, breakTime) {
        const totalTime = workTime + breakTime;
        if (totalTime === 0) return 0;
        return Math.round((workTime / (workTime + breakTime)) * 100);
      }

      function updateStatistics() {
        totalWorkTimeEl.textContent = formatTime(workingTime);
        totalBreakTimeEl.textContent = formatTime(breakTime).substring(3);
        const productivity = calculateProductivity(workingTime, breakTime);
        productivityEl.textContent = `${productivity}%`;
        
        if (workStartTime) {
          const startHour = workStartTime.getHours();
          const startMinute = workStartTime.getMinutes();
          
          if (startHour > 9 || (startHour === 9 && startMinute > 15)) {
            isLate = true;
            const lateMinutes = (startHour - 9) * 60 + (startMinute - 15);
            lateBy = Math.max(0, lateMinutes);
            statusEl.textContent = `Late by ${lateBy} min`;
            statusEl.style.color = '#e74c3c';
          } else {
            statusEl.textContent = 'On Time';
            statusEl.style.color = '#2ecc71';
          }
        }
      }

      function generatePdf() {
        const element = document.getElementById('alertss');
        const opt = {
          margin: 10,
          filename: `work-summary-${new Date().toISOString().split('T')[0]}.pdf`,
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        const originalText = downloadBtn.innerHTML;
        downloadBtn.disabled = true;
        downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
        html2pdf()
          .set(opt)
          .from(element)
          .save()
          .then(() => {
            downloadBtn.disabled = false;
            downloadBtn.innerHTML = '<i class="fas fa-file-pdf"></i> Download Summary';
          });
      }

      function endWorkday() {
        if (!task.value.trim() || !chanllenge.value.trim() || !nextSteps.value.trim()) {
          alert("Please fill in all fields before ending your day");
          return;
        }
        
        clearInterval(timerInterval);
        const now = new Date();
        arrivalTime.textContent = workStartTime ? formatSimpleTime(workStartTime) : "N/A";
        departureTime.textContent = formatSimpleTime(now);
        todayTaskss.textContent = task.value;
        todayDifficylty.textContent = chanllenge.value;
        todaySteps.textContent = nextSteps.value;
        updateStatistics();
        document.querySelector('.bottoms').style.display = 'block';
        document.querySelector('.bottoms').scrollIntoView({ behavior: 'smooth' });
        startButton.textContent = "Start";
        breakButton.textContent = "Start Break";
        systemTimeDiv.textContent = "Work session ended";
        systemBreakDiv.textContent = "Break time will be shown here";
        isWorking = false;
        isOnBreak = false;
      }

      startButton.addEventListener("click", startWork);
      breakButton.addEventListener("click", startBreak);
      stopAllTimersButton.addEventListener("click", endWorkday);
      downloadBtn.addEventListener("click", generatePdf);
      updateDisplay();
      setInterval(updateStatistics, 60000);
      
      document.getElementById('signOutBtn').addEventListener('click', function() {
        localStorage.removeItem('currentUser');
        clearInterval(timerInterval);
        window.location.href = 'index.html';
      });
    </script>
  </body>
</html>
